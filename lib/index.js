"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var request=require("request"),DingRobot=function(){function t(t){this.robotHookUrl="https://oapi.dingtalk.com/robot/send?access_token="+t}return t.prototype.notify=function(t){var e=this,n=t.get();return new Promise(function(i,s){request({url:e.robotHookUrl,method:"POST",json:!0,headers:{"Content-Type":"application/json;charset=UTF-8"},body:n},function(t,e,n){var r=n.errcode,o=n.errmsg;r?s({errcode:r,errmsg:o}):i()})})},t}(),extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var MessageTemplateAbs=function(){function e(){var t=this.constructor;if(this.canAt=!1,this.isAtAll=!1,this.atMobiles=new Set,t===e)throw new Error("抽象类不可以实例化")}return e.prototype.render=function(t){return Object.assign({msgtype:this.msgtype},t,this.canAt?{at:{atMobiles:Array.from(this.atMobiles),isAtAll:this.isAtAll}}:{})},e.prototype.get=function(){throw new Error("抽象方法render不可以调用")},e.prototype.toJsonString=function(){throw new Error("抽象方法toJsonString不可以调用")},e.prototype.atAll=function(){return this.isAtAll=!0,this},e.prototype.at=function(t){var e=this;return t instanceof Array?t.map(function(t){e.atMobiles.add(t)}):this.atMobiles.add(t),this},e}(),Text=function(n){function t(t){var e=n.call(this)||this;return e.msgtype="text",e.canAt=!0,t&&e.setContent(t),e}return __extends(t,n),t.prototype.setContent=function(t){this.content=t},t.prototype.get=function(){return this.render({text:{content:this.content}})},t}(MessageTemplateAbs),Markdown=function(e){function t(){var t=e.call(this)||this;return t.msgtype="markdown",t.canAt=!0,t.items=[],t}return __extends(t,e),t.prototype.setTitle=function(t){return this.title=t,this},t.prototype.add=function(t){Array.isArray(t)?this.items.concat(t):this.items.push(t)},t.prototype.addBoldText=function(t){return this.items.push("**"+t+"**"),this},t.prototype.addItalicText=function(t){return this.items.push("*"+t+"*"),this},t.prototype.addLinkText=function(t,e){return this.items.push("["+t+"]("+e+")"),this},t.prototype.addImageText=function(t,e){return void 0===e&&(e="image"),this.items.push("!["+e+"]("+t+")"),this},t.prototype.addHeaderText=function(t,e){return t=Math.max(1,Math.min(6,t)),this.items.push("#".repeat(t)+" "+e),this},t.prototype.addSeparator=function(){return this.items.push("---"),this},t.prototype.addReferenceText=function(t){return this.items.push("> "+t),this},t.prototype.addOrderListText=function(t){var n=this;return t.map(function(t,e){n.items.push(e+". "+t)}),this},t.prototype.addUnorderListText=function(t){var n=this;return t.map(function(t,e){n.items.push("- "+t)}),this},t.prototype.get=function(){return this.render({markdown:{title:this.title,text:this.items.join("\n")}})},t}(MessageTemplateAbs),Link=function(e){function t(){var t=e.call(this)||this;return t.msgtype="link",t.link={title:"",text:"",messageUrl:"",picUrl:""},t}return __extends(t,e),t.prototype.setTitle=function(t){this.link.title=t},t.prototype.setMessageUrl=function(t){this.link.messageUrl=t},t.prototype.setText=function(t){this.link.text=t},t.prototype.setPicUrl=function(t){this.link.picUrl=t},t.prototype.get=function(){return this.render({link:this.link})},t}(MessageTemplateAbs);exports.DingRobot=DingRobot,exports.Text=Text,exports.Markdown=Markdown,exports.Link=Link,exports.default=DingRobot;
